#!/bin/bash
# This script is the main entry point for CapGate CLI commands.
# It ensures the application is run with sudo and uses the correct Python virtual environment.

# Get the directory where this script is located (now /home/nexus/nexusdevtools/)
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

# Path to your virtual environment's python executable
PYTHON_EXEC="${SCRIPT_DIR}/.venv/bin/python"

# Path to your new CapGate main entry file
MAIN_APP="${SCRIPT_DIR}/capgate.py" # Changed from main.py to capgate.py

# Check if the Python executable exists
if [ ! -f "$PYTHON_EXEC" ]; then
    echo "Error: Python executable not found at $PYTHON_EXEC" >&2
    echo "Please ensure your virtual environment is set up correctly in $SCRIPT_DIR/.venv/" >&2
    exit 1
fi

# Check if capgate.py exists
if [ ! -f "$MAIN_APP" ]; then
    echo "Error: capgate.py not found at $MAIN_APP" >&2
    echo "Please ensure capgate.py is in the root of your project: $SCRIPT_DIR/" >&2
    exit 1
fi

# Execute capgate.py with sudo, preserving current environment variables (-E),
# and pass all arguments ($@) from the command line.
sudo -E "$PYTHON_EXEC" "$MAIN_APP" "$@"