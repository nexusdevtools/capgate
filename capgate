#!/bin/bash
# This script is the main entry point for CapGate CLI commands.
# It ensures the application is run with sudo and uses the correct Python virtual environment.

# Get the directory where this script (capgate) is located
# This will be /home/nexus/capgate/
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

# Path to your virtual environment's python executable
PYTHON_EXEC="${SCRIPT_DIR}/.venv/bin/python"

# Path to your main.py application entry point
MAIN_APP="${SCRIPT_DIR}/main.py"

# Check if the Python executable exists
if [ ! -f "$PYTHON_EXEC" ]; then
    echo "Error: Python executable not found at $PYTHON_EXEC" >&2
    echo "Please ensure your virtual environment is set up correctly in $SCRIPT_DIR/.venv/" >&2
    exit 1
fi

# Check if main.py exists
if [ ! -f "$MAIN_APP" ]; then
    echo "Error: main.py not found at $MAIN_APP" >&2
    echo "Please ensure main.py is in the root of your CapGate project: $SCRIPT_DIR/" >&2
    exit 1
fi

# Execute main.py with sudo, preserving current environment variables (-E),
# and pass all arguments ($@) from the command line.
sudo -E "$PYTHON_EXEC" "$MAIN_APP" "$@"